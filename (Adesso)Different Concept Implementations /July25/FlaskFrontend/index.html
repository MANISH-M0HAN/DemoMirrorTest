<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Interface</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <button class="chatbot-button" onclick="toggleChatbot()">ðŸ’¬</button>
    <div class="chatbot-window" id="chatbot-window">
        <div class="chatbot-header">Heart Health Chatbot</div>
        <div class="chatbot-messages" id="chatbot-messages"></div>
        <div class="chatbot-input">
            <input type="text" id="chatbot-input" placeholder="Type a message..." onkeypress="handleKeyPress(event)" />
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>
    <script>
        const chatbotWindow = document.getElementById('chatbot-window');
        const chatbotMessages = document.getElementById('chatbot-messages');
        const chatbotInput = document.getElementById('chatbot-input');

        function toggleChatbot() {
            chatbotWindow.classList.toggle('open');
            if (chatbotWindow.classList.contains('open')) {
                chatbotInput.focus();
            }
        }

        function appendMessage(text, user = true) {
            const message = document.createElement('div');
            message.classList.add('message', user ? 'user' : 'bot');
            message.textContent = text;
            chatbotMessages.appendChild(message);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendMessage();
            }
        }

        async function sendMessage() {
            const userInput = chatbotInput.value.trim();
            if (!userInput) return;

            appendMessage(userInput, true);
            chatbotInput.value = '';

            try {
                const response = await fetch('http://127.0.0.1:5000/chatbot', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_input: userInput })
                });

                const data = await response.json();
                if (data.response) {
                    appendMessage(data.response, false);
                } else {
                    appendMessage("Sorry, I couldn't understand that. Please try again.", false);
                }
            } catch (error) {
                console.error('Error communicating with the chatbot:', error);
                appendMessage("There was an error connecting to the chatbot.", false);
            }
        }
    </script>
</body>
</html>
